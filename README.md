# ????????????????

## 1? ?????????

* Google Chrome: ?????webkit????blink;
* Mozilla Firfox :Gecko;
* Opera: blink;
* Safari: webkit;
* IE: Trident;
* 360??????IE??;
* 360??????Chromium?IE??;
* QQ????????-Trident?????-webkit;

## 2????????

* ???? ? ????????/???????????????????????????????????????????
* ????? ? ???????????????
* ???? ? ????????????????????html??????html?css??????????????
* ?? ? ???????????http?????????????????????????
* UI?? ? ???????????????????????????????????????????????????
* JS??? ? ??????JS???
* ???? ? ???????????????????cookie??????HTML5???web database????????????????????

![image](./img/2.png)

## 3??????Rendering Engine?

> ????????html?xml????????????????????pdf???

### [1]?????????MainFlow?

![image](./img/1.png)

#### ????

>??Dom Tree -----> ??Render Tree -----> ??Render Tree -----> ??Render Tree

### ?????

* ?????????html???Dom Tree???????????????????????????node??
* ???????css??????????CSS??????????Css Rule Tree?style rules??
* DOM?CSSOM?Css Rule Tree??????Render Tree?
* layout???Render Tree??????????????node?????node?????css???????????node????????
* Painting??????????????????????????

???webkit??????

![image](./img/3.png)

#### [2]??????

* JavaScript?JavaScript???????DOM??????
* Style???????????DOM????????CSS???
* Layout?????????DOM???????????????????web???????????????????????????????????????????????????reflow?
* Paint????????????DOM????????????????????
* Composite????????????????????????????

?????????????

![image](./img/4.png)


## 4?Reflow????/Repaint????

* reflow????????????????????Dom Tree??????????????????dom node???????????width?height?margin?padding?border-width??
* repaint????????????????????Dom Tree???????????????????????color?background-color????????????

## 5?compositor layer???????

> ???????????????????

![image](./img/5.png)

> ??transform/opacity ????????????repaint/reflow????????????????????????????????div,???100px, ??JS????????left???????div???????transform:translate(0,100px) ,transition:2s ????????????div??????????????????div???????????????????????????
> ????3d?????????????????????translate3d?translateZ????????????

## 6???????????????

> ???????????60?/??????????????????????16ms????????????????????????????????
> ?????????????????????????????

### [1]??JavaScript?????

#### ????requestAnimationFrame???setInternal?setTimeout

> ?????????setTimeout?setInterval?????requestAnimationFrame
> setTimeout(callback)?setInterval(callback)????callback????????????????????????????????

![image](./img/6.png)

> requestAnimationFrame(callback)????callback???????????????
>> jQuery?animate?????setTimeout??????????jquery-requestAnimationFrame??????requestAnimationFrame??setTimeout?

``` javascript
    // requestAnimationFrame???updateScreen??????????
    requestAnimationFrame(updateScreen);
```

???requestAnimationFrame?????
![image](./img/7.png)

#### ??webSocket????????js??

> JavaScript?????????????????????????????????????????????JavaScript?????????????????????????????
> ???????????60?/??????????????????????16ms????????????????????????????????
> ???????????????????????JavaScript???????????3-4???
> ?????????????DOM???????????????Web Workers????

```
    var dataSortWorker = new Worker("sort-worker.js");

    dataSortWorker.postMesssage(dataToSort);

    // ?????Web Workers????
    dataSortWorker.addEventListener('message', function(evt) {
        var sortedData = e.data;

        // Web Workers??????
        // ...
    });
```

???webSocket?????

![image](./img/8.png)

#### ?DOM???????????????????frame????
> webSocket??????????DOM??????????????????DOM????????????????????requestAnimationFrame?callback????

```
 var taskList = breakBigTaskIntoMicroTasks(monsterTaskList);
 requestAnimationFrame(processTaskList);
 function processTaskList(taskStartTime) {
    var nextTask = taskList.pop();
    // ?????
    processTask(nextTask);
    if (taskList.length > 0) {
        requestAnimationFrame(processTaskList);
    }
}
```

#### ??Chrome DevTools > Timeline > JS Profile????????????????????????????????

### [2] ?????????????

> ??DOM??????????????????????DOM??????reflow???????????
> ???????????
>> * ????????????
>> * ???????????????????

#### ????class???????Web Components???

```
    .box:nth-last-child(-n+1) .title {
    }
    // ???
    .final-box-title {
    }
```

#### ???????????????

>?????????????????????????????????????????????????

### [3]???????????

> ??????DOM?????????????????????????????????????????????
> ??????????
>> *  ?????DOM??????
>> * ?????????

#### ????????

> ?????????(???????DOM??????????width/height/left/top)?????Chrome DevTools???Timeline???????

#### ??flexbox?????????

> ??????/??/???flexbox??????
???flexbox??????

![image](./img/9.png)

#### ????????
> ?????????????????JavaScript???????????????????????
```
requestAnimationFrame(logBoxHeight);
// ???????????
    function logBoxHeight() {
        // ??box??
        box.classList.add('super-big');

        // ????box?offersetHeight?
        // ?????????????????????
        console.log(box.offsetHeight);
    }
    // ???????????
    function logBoxHeight() {
        // ??box.offsetHeight
        console.log(box.offsetHeight);

        // ??box??
        box.classList.add('super-big');
    }
```
>  ?JavaScript??????????????????????????????????????????????????????????????????????????????????????????????JavaScript???

#### ???????????????
> ????????????????????
> ??????????box???????paragraphs????????paragraphs????????????????????box?????????????????????
```
    function resizeWidth() {`
        // ???????'????'??
        for (var i = 0; i < paragraphs.length; i++) {
            paragraphs[i].style.width = box.offsetWidth + 'px';
        }
    }
    // ?????
    var width = box.offsetWidth;
    function resizeWidth() {
        for (var i = 0; i < paragraphs.length; i++) {
            paragraphs[i].style.width = width + 'px';
        }
    }
```

### ???????????????

> ???????????????????????????????????????
> Layout???????Paint????????????????????????????????????????Paint?

#### ?????????????

> ????????????????????????????????????????????????????????????????????
> ?????????????transform????????????????????????????????

#### ??????

> ????????????????????????????????????????????????????????

### [4]?????????????????

#### ??transform/opacity????????????????????????????????

>?????????????????????????

#### ??????????

> ??????????????????????CSS??winll-change?????????will-change????????????????????3D transform???????????????????????????????????????????????????????
```
    .moving-element {
         will-change: transform;
         transform: translateZ(0);
    }
```

winll-change?????

![image](./img/10.png)


> [???????????????????????](http://www.cnblogs.com/yanglang/p/7090120.html)
> [?????????reflow/repaint](http://blog.csdn.net/alex8046/article/details/43834453)

